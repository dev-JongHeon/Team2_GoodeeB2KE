
@{
    ViewBag.Title = "FindAddress";
}

<h2>FindAddress</h2>

@using (Html.BeginForm("FindAddress", "Address", FormMethod.Post, new { @class = "form-horizontal", @id = "address_form" }))
{
    <input type="hidden" name="currentPage" value="1" />
    <input type="hidden" name="countPerPage" value="5" />
    <input type="hidden" name="confmKey" value="devU01TX0FVVEgyMDIwMDIxNjEzMTEzNjEwOTQ3MDA=" />
    @*@Html.Hidden("currentPage", 1);
        @Html.Hidden("countPerPage", 5);
        @Html.Hidden("confmKey", "devU01TX0FVVEgyMDIwMDIxNjEzMTEzNjEwOTQ3MDA");*@

    <div class="row">
        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon"> 검색어 </span>
                <input type="text" class="form-control" name="keyword" />
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button" onclick="javascript: getAddrLoc();">검색</button>
                </span>
            </div>
        </div>
    </div>
}

<div id="list" class="col-lg-12"></div>


@section Scripts{

    <script type="text/javascript">
        function getAddrLoc() {
            $.ajax({
                url: "/Address/RoadAddress",
                type: "post",
                data: $("address_form").serialize(),
                dataType: "text",
                success: function (result) {
                    xmlStr = $.parseXML(result);

                    $("#list").html("");
                    var errCode = $(xmlStr).find("errorCode").text();
                    var errDesc = $(xmlStr).find("errorMessage").text();

                    if (errCode != "0") {
                        alert(errCode + "=" + errDesc);
                    } else {
                        if (xmlStr != null) makeList(xmlStr);
                        else makeList(xmlStr);
                    }
                },
                error: function (xhr, status, error) {
                    alert("에러발생 : xhr - " + xhr + " | status - " + status + " | error - " + error);
                }
            });
        }


        function makeList(xmlStr) {
            var htmlStr = "";
            htmlStr += "<table class =\" table table-striped table-hover \">";
            htmlStr += "<thead>";
            htmlStr += "<tr>";
            htmlStr += "<th>선택</th>";
            htmlStr += "<th>도로명주소</th>";
            htmlStr += "<th>도로상세1</th>";
            htmlStr += "<th>도로상세2</th>";
            htmlStr += "<th>지번주소</th>";
            htmlStr += "<th>영문주소</th>";
            htmlStr += "<th>우편주소</th>";
            htmlStr += "</tr>";
            htmlStr += "</thead>";
            htmlStr += "<tbody>";
            $(xmlStr).find("juso").each(function () {

                htmlStr += "<tr>";
                htmlStr += "<td><input type =\"radio\" name =\"address_data\" value=\"" +
                    $(this).find('zipNo').text() + "\"/></td>";
                htmlStr += "<tr>";
                htmlStr += "<td><small><p><b>" + $(this).find('roadAddr').text() + "</b></p></td>";
                htmlStr += "<td><small><p>" + $(this).find('jibunAddr').text() + "</p></small></td>";
                htmlStr += "<td>" + $(this).find('engAddr').text() + "</td>";
                htmlStr += "<td>" + $(this).find('zipNo').text() + "</td>";
                htmlStr += "<td>" + $(this).find('admCd').text() + "</td>";
                htmlStr += "<td>" + $(this).find('rnMgtSn').text() + "</td>";
                htmlStr += "<td>" + $(this).find('bdMgtSn').text() + "</td>";
            });
            htmlStr += "</tbody>";
            htmlStr += "</table>";
            $("#list").html(htmlStr);
        }

        function enterSearch() {
            var evt_code = (window.netscape) ? ev.which : event.keyCode;
            if (evt_code == 13) {
                ev.keyCode = 0;
                getAddrLoc();
            }
        }


    </script>
    }
